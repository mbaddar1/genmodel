This code is authored by David Sommer and Charles M